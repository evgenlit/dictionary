/*
 * NoGray Time Picker Lite Component
 *
 * Copyright (c), All right reserved
 * Gazing Design - http://www.NoGray.com
 * http://www.nogray.com/license.php
 */
 
ng.Assets.load_style(ng_config.assets_dir+"components/timepicker/css/"+ng_config.css_skin_prefix+"timepicker_style.css");ng.TimePicker=function(b){this.p=this.create_options(b,{top_hour:0,start:"12:00 am",end:"11:59 pm",range_off:null,value:null,format:"h:i a",server_format:"h:i a",use24:false,css_prefix:"ng_timepicker_",radius:75,always_simple:false,picker_image:ng_config.assets_dir+"components/timepicker/images/clock_icon.png",picker_image_disabled:ng_config.assets_dir+"components/timepicker/images/clock_icon_disabled.png",sun:"&#9728;",moon:"&#9790;",close_on_select:true});this.create_events();if(this.p.disabled){this.p.disabled=false;this.disable.delay(100,this);}this.make_id("timepicker");var a=new Date();this.p.date=new Date(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0,0);this.set_start(this.p.start,true).set_end(this.p.end,true);this.set_top_hour(this.p.top_hour,true);if(ng.defined(this.p.range_off)){this.process_range_off();}if((ng.defined(this.p.input))||(ng.defined(this.p.object))){this.make();}};ng.TimePicker.inherit(ng.Component);ng.extend_proto(ng.TimePicker,{has_type:"slider",select_time:function(c,d){var b=c;var c=this.process_time(c);if(this.is_time_off(c)){var f=this.is_out_of_range(c);if(f[0]){var a=f[2];var h=1;if(Math.abs(c-f[1])<Math.abs(c-f[2])){a=f[1];var h=-1;}var e=new Date(a);var g=e.getMinutes()+(5*h);g=g-(g%5);e.setMinutes(g);this.fire_event("selectRangeOff");return this.select_time(e.getHours()+":"+e.getMinutes());}else{this.fire_event("selectBeforeStart");return this.unselect_time();}}if(ng.defined(this.p.value)){this.unselect_time();}this.p.value=c;if(!ng.defined(d)){this.fire_event("select");}this.update_field_value();return this.update_status();},unselect_time:function(){if(ng.defined(this.p.value)){this.p.value=null;this.fire_event("unselect");this.update_field_value();return this.update_status();}return this;},update_field_value:function(){if(ng.defined(this.p.value)){var a="en";if((ng.is_lite)&&(!ng.defined(ng_lang.en))){a=this.get_language();}ng.Language.load("general",a);var c=new Date(this.process_time(this.p.value));var d=c.print(this.p.server_format,a);var b=c.print(this.p.format,this.get_language());}else{var d="";var b="";}if(ng.defined(this.p.input_field)){this.p.input_field.value=d;}if(ng.defined(this.get_input())){this.get_input().value=b;}return this;},process_time:function(c){if(ng.type(c)=="number"){return c;}else{if(ng.type(c)=="date"){return c.getTime();}else{c=c.toLowerCase();if(this.get_language()!="en"){c=ng.Language.numbers_to_english(c,this.get_language());var d=ng.Language.get_language(this.get_language()).date.am_pm;c=c.replace(d.lowercase[0],"am").replace(d.lowercase[1],"pm").replace(d.uppercase[0],"am").replace(d.uppercase[0],"pm");}var e=this.p.date.clone();var b=new Date(this.p.start_time);var f=0;if(c.indexOf("pm")!=-1){f=12;}var a=c.split(":");a[0]=a[0].to_int();if(isNaN(a[0])){a[0]=b.getHours();}if((a[0]==12)&&(f==12)){a[0]=0;}else{if((a[0]==12)&&(c.indexOf("am")!=-1)){a[0]=0;}}a[0]=(a[0]+f)%24;e.setHours(a[0]);if(!ng.defined(a[1])){a[1]=b.getMinutes();}a[1]=a[1].to_int();if(isNaN(a[1])){a[1]=0;}e.setMinutes(a[1]);return e.getTime();}}return c;},is_time_off:function(a){a=this.process_time(a);if(a<this.p.start_time){return true;}if(a>this.p.end_time){return true;}if(this.is_out_of_range(a)[0]){return true;}return false;},is_out_of_range:function(a){if(ng.defined(this.p.range_off)){a=this.process_time(a);var c=this.p.range_off;for(var b=0;b<c.length;b++){if((a>=c[b][0])&&(a<=c[b][1])){return[true,c[b][0],c[b][1]];}}}return[false,0,0];},make:function(c){var b="";var f=false;if(ng.defined(c)){this.p.input=c;}if(ng.defined(this.p.input)){this.p.input_field=ng.get(this.p.input);b=this.p.input_field.value;f=true;}if(f){var e=this.get_input_html();ng.hold_html(e);this.p.input_table_holder=ng.get("input_button_table"+this.id);this.set_input(ng.create("input",{id:"input_field"+this.id,events:{change:function(){var g=this.get_input().value;if(g!=""){this.select_time(g);}else{this.unselect_time();}if(this.p.close_on_select){this.close.delay(100,this);}this.fire_event("change");}.bind(this),keydown:function(n){var l=this.get_input();if((n.key=="enter")&&(this.is_open())){l.fire_event("change");l.blur();this.close();n.stop();return this;}var h=function(r){if(document.selection){l.focus();var q=document.selection.createRange();q.moveStart("character",r-l.value.length);q.moveEnd("character",r-l.value.length);q.select();}else{if(l.selectionStart||l.selectionStart=="0"){l.selectionStart=r;l.selectionEnd=r;l.focus();}}}.bind(this);var m=function(){var s=this.get_input();if(document.selection){s.focus();var t=document.selection.createRange();var r=t.text.length;t.moveStart("character",-s.value.length);var q=t.text.length-r;}else{if(ng.defined(this.p.input.selectionStart)){var q=s.selectionStart;}}return[s.value.substr(0,q),s.value.substr(q)];}.bind(this);var p=0;if(n.key=="up"){p=-1;var o=this.p.end_time;}else{if(n.key=="down"){p=1;var o=this.p.start_time;}}if(p!=0){if(!ng.defined(this.p.value)){this.select_time(o);h(0);}else{var i=new Date(this.p.value);var k=m();if(k[0].indexOf(":")==-1){i.setHours((i.getHours()+p)%24);}else{var j=i.getMinutes()+(p*5);j=j-(j%5);i.setMinutes(j);}var g=this.is_out_of_range(i);if(g[0]){if(p==-1){var i=new Date(g[1]);}else{var i=new Date(g[2]);}}this.select_time(i.getHours()+":"+i.getMinutes());h(k[0].length);}}}.bind(this)}}));ng.get("input_holder_td"+this.id).append_element(this.get_input());var a=this.get_input();if(ng.defined(this.p.input_field)){var d=this.p.input_field;d.type="text";d.append_element(this.p.input_table_holder,"before");a.className+=" "+d.className;a.readOnly=d.readOnly;a.size=d.size;a.placeholder=d.placeholder;if(d.disabled){this.disable.delay(100,this);}d.value="";d.set_style("display","none");}this.p.icon_button=new ng.Button({icon:this.p.picker_image,stop_default:true,hide_component:true,color:this.p.buttons_color,over_color:this.p.buttons_over_color,down_color:this.p.buttons_down_color,disable_color:this.p.buttons_disable_color,gloss:this.p.buttons_gloss,checked_color:this.p.buttons_checked_color,light_border:this.p.buttons_light_border,events:{disable:function(){this.p.icon_button.set_icon(this.p.picker_image_disabled);}.bind(this),enable:function(){this.p.icon_button.set_icon(this.p.picker_image);}.bind(this)}});this.p.icon_button.make("button_holder_td"+this.id);this.set_button(this.p.icon_button);}var e='<div id="'+this.id+'_holder" class="'+this.p.css_prefix+'holder"></div>';this.set_html(e);this.p.holder_div=ng.get(this.id+"_holder");this.p.holder_div.add_events({click:function(m){if(this.is_disabled()){return;}var h=m.src_element;var o=h.get("rel");if(h.has_class(this.p.css_prefix+"off")){return;}if((ng.defined(o))&&(o!="")){var g=this.get_render_date();var l=g.getHours();var i=g.getMinutes();var j=new Date(this.p.start_time);var k=new Date(this.p.end_time);var n=false;if(o.indexOf("hour_")!=-1){l=o.replace("hour_","").to_int();if((l==j.getHours())&&(i<j.getMinutes())){i=j.getMinutes();}else{if((l==k.getHours())&&(i>k.getMinutes())){i=k.getMinutes();}}}else{if(o.indexOf("minute_")!=-1){i=o.replace("minute_","").to_int();n=true;}}this.select_time(l+":"+i);if((n)&&(this.p.close_on_select)){this.close.delay(100,this);}}}.bind(this),mouseover:function(h){if(this.is_disabled()){return this;}var j=h.src_element;var g=j.get("rel");if(j.has_class(this.p.css_prefix+"off")){return this.update_display_time();}if((ng.defined(g))&&(g!="")){var k=this.get_render_date();var i=k.getHours();var l=k.getMinutes();if(g.indexOf("hour_")!=-1){i=g.replace("hour_","").to_int();}else{if(g.indexOf("minute_")!=-1){l=g.replace("minute_","").to_int();}}this.update_display_time(i+":"+l);}}.bind(this),mouseout:function(){if(this.is_disabled()){return this;}this.update_display_time();}.bind(this)});this.p.is_advance=false;this.render();if(ng.defined(this.p.value)){this.select_time(this.p.value,true);}if((b!="")&&(!ng.defined(this.p.value))){this.select_time(b,true);}return this;},render:function(){return this.simple_render();},update_display_time:function(a){if((!ng.defined(a))||(a=="")){ng.get(this.id+"_simple_display").set_html("");}var a=this.process_time(a);var b=new Date(a);ng.get(this.id+"_simple_display").set_html(b.print(this.p.format,this.get_language()));return this;},simple_render:function(){var c=this.p.css_prefix;var d=this.p.top_hour;var e=function(f){var h=(d+f);var g=h;h=h%24;if(g==12){g=this.p.sun;var j=this.p.sun;}else{if((g==24)||(g==0)){g=this.p.moon;var j=this.p.moon;}else{g=g%12;if(this.p.use24){var j=ng.Language.translate_numbers(h,this.get_language());}else{var j=ng.Language.translate_numbers(g,this.get_language());}}}return'<td id="'+this.id+"_hour_"+h+'" rel="hour_'+h+'" class="'+c+"hour "+c+"hour_"+h+'">'+j+"</td>";}.bind(this);var b=function(h,f){var g='<td id="'+this.id+"_minute_"+h+'" rel="minute_'+h+'" class="'+c+"minute "+c+"minute_"+h+'"';if(ng.defined(f)){g+=' colspan="'+f+'" ';}g+=">"+ng.Language.translate_numbers(h,this.get_language())+"</td>";return g;}.bind(this);var a=['<table cellspacing="0" cellpadding="0" class="'+c+'simple_table">'];a.push("<tr>"+e(21)+e(22)+e(23)+e(0)+e(1)+e(2)+e(3)+"</tr>");a.push("<tr>"+e(20)+b(55,2)+b(0)+b(5,2)+e(4)+"</tr>");a.push("<tr>"+e(19)+b(50));a.push('<td id="'+this.id+'_simple_display" class="'+c+'simple_display" rowspan="3" colspan="3">&nbsp;</td>');a.push(b(10)+e(5)+"</tr>");a.push("<tr>"+e(18)+b(45)+b(15)+e(6)+"</tr>");a.push("<tr>"+e(17)+b(40)+b(20)+e(7)+"</tr>");a.push("<tr>"+e(16)+b(35,2)+b(30)+b(25,2)+e(8)+"</tr>");a.push("<tr>"+e(15)+e(14)+e(13)+e(12)+e(11)+e(10)+e(9)+"</tr>");a.push("</table>");this.p.holder_div.set_html(a);return this.update_status();},update_status:function(){if(this.p.value==""){this.p.value=null;}var b=ng.defined(this.p.value);var h=-1;var c=-1;if(b){var j=this.process_time(this.p.value);var a=new Date(j);h=a.getHours();c=a.getMinutes();c=c-(c%5);}else{this.disable_all_minutes();}var g=this.p.css_prefix;for(var e=0;e<24;e++){var k=ng.get(this.id+"_hour_"+e);if((this.is_time_off(e+":59"))&&(this.is_time_off(e+":00"))){k.add_class(g+"off");k.remove_class(g+"selected");}else{if(h==e){k.add_class(g+"selected");}else{k.remove_class(g+"selected");}k.remove_class(g+"off");}}if(b){for(var e=0;e<12;e++){var d=(e*5)%60;var f=ng.get(this.id+"_minute_"+d);if(this.is_time_off(h+":"+d)){f.add_class(g+"off");f.remove_class(g+"selected");}else{f.remove_class(g+"off");if(c==d){f.add_class(g+"selected");}else{f.remove_class(g+"selected");}}}}return this;},disable_all_minutes:function(){for(var b=0;b<12;b++){var c=(b*5)%60;var a=ng.get(this.id+"_minute_"+c);a.add_class(this.p.css_prefix+"off");a.remove_class(this.p.css_prefix+"selected");}},get_render_date:function(){if(ng.defined(this.p.value)){return new Date(this.process_time(this.p.value));}return this.p.date.clone();},set_top_hour:function(a,b){a=a.to_int();if(a<0){a=0;}if(a>23){a=23;}this.p.top_hour=a;if(!ng.defined(b)){this.render();}return this;},get_top_hour:function(){return this.p.top_hour;},set_start:function(a,b){this.p.start=a;this.p.start_time=this.process_time(this.p.start);if(!ng.defined(b)){this.update_status();}return this;},get_start:function(){return this.p.start;},set_end:function(a,b){this.p.end=a;this.p.end_time=this.process_time(this.p.end);if(!ng.defined(b)){this.update_status();}return this;},get_end:function(){return this.p.end;},process_range_off:function(){var c=this.p.range_off;if(!ng.defined(c)){return this;}var a=[];if(ng.type(c[0])!="array"){c=[[c[0],c[1]]];}for(var b=0;b<c.length;b++){a.push([this.process_time(c[b][0]),this.process_time(c[b][1])]);}this.p.range_off=a;return this;},set_range_off:function(a){this.p.range_off=a;this.process_range_off();return this.update_status();},get_range_off:function(a){return this.p.range_off;},set_format:function(a){this.p.format=a;return this.update_field_value();},get_format:function(){return this.p.format;},set_server_format:function(a){this.p.server_format=a;return this.update_field_value();},get_server_format:function(){return this.p.server_format;},set_radius:function(a){this.p.radius=a;return this.render();},get_radius:function(){return this.p.radius;},set_sun:function(a){this.p.sun=a;ng.get(this.id+"_hour_12").set_html(a);return this;},get_sun:function(){return this.p.sun;},set_moon:function(a){this.p.moon=a;ng.get(this.id+"_hour_0").set_html(a);return this;},get_moon:function(){return this.p.moon;},set_close_on_select:function(a){this.p.close_on_select=a;return this;},get_close_on_select:function(){return this.p.close_on_select;},set_use24:function(a){this.p.use24=a;return this.render();},get_use24:function(){return this.p.use24;}});ng.map_html5_prop("time",{min:"start",max:"end"});